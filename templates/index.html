{% extends "base.html" %}

{% block content %}
<div class="content-card fade-in">
    <div class="header-section">
        <h1>Menu Principal</h1>
        <p class="subtitle">Gerencie as atas da sua ala de forma simples e organizada</p>
    </div>
    
    <div class="form-actions">
        <a href="{{ url_for('nova_ata') }}" class="btn">
            üìù Criar Nova Ata
        </a>
    </div>

    <!-- Pr√≥xima Reuni√£o Sacramental -->
    {% if proxima_reuniao %}
    <div class="proxima-reuniao-card slide-in">
        <div class="reuniao-header">
            <h3>üéØ Pr√≥xima Reuni√£o Sacramental</h3>
            <div class="badge">Pr√≥ximo</div>
        </div>
        <div class="reuniao-info">
            <div class="reuniao-details">
                <div class="detail-item">
                    <span class="detail-label">üìÖ Data:</span>
                    <span class="detail-value">{{ proxima_reuniao.data_formatada }}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">üìä Status:</span>
                    <span class="detail-value {% if proxima_reuniao.ata_existente %}status-complete{% else %}status-pending{% endif %}">
                        {{ 'Ata Criada' if proxima_reuniao.ata_existente else 'Pendente' }}
                    </span>
                </div>
            </div>
            <div class="reuniao-actions">
                {% if proxima_reuniao.ata_existente %}
                <a href="{{ url_for('visualizar_ata', ata_id=proxima_reuniao.ata_id) }}" class="btn btn-gold">
                    ‚úèÔ∏è Ver Ata Existente
                </a>
                {% else %}
                <a href="{{ url_for('form_ata', tipo='sacramental', data=proxima_reuniao.data) }}" class="btn">
                    üìù Criar Ata
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Seletor de M√™s Moderno -->
    <div class="filter-section">
        <div class="filter-header">
            <h3>üìÖ Visualizar Atas por M√™s</h3>
        </div>
        <div class="form-group">
            <label for="mes_selecionado">Selecionar M√™s:</label>
            <div class="select-wrapper">
                <select id="mes_selecionado" name="mes_selecionado" onchange="carregarAtas(this.value)">
                    <option value="">Selecione um m√™s</option>
                    {% for mes in meses %}
                    <option value="{{ mes.value }}" {% if mes.value == mes_atual %}selected{% endif %}>
                        {{ mes.nome }}
                    </option>
                    {% endfor %}
                </select>
                <div class="select-arrow">‚ñº</div>
            </div>
        </div>
    </div>

    <!-- √Årea onde as atas ser√£o carregadas -->
    <div id="atas-container" class="atas-container">
        {% if atas %}
        <div class="atas-list-section fade-in">
            <div class="section-header">
                <h2>Atas do {{ mes_selecionado_nome }}</h2>
                <div class="result-count">{{ atas|length }} atas encontradas</div>
            </div>
            
            {% if atas %}
            <div class="results-grid">
                {% for ata in atas %}
                <div class="ata-card">
                    <div class="ata-header">
                        <div class="ata-type {{ ata.tipo }}">{{ ata.tipo|capitalize }}</div>
                        <div class="ata-date">{{ ata.data }}</div>
                    </div>
                    <div class="ata-body">
                        <div class="ata-status">
                            <span class="status-badge {{ ata.status|default('completa', true)|lower }}">
                                {{ ata.status|default('Completa', true) }}
                            </span>
                        </div>
                    </div>
                    <div class="ata-actions">
                        <a href="{{ url_for('visualizar_ata', ata_id=ata.id) }}" class="btn btn-sm">
                            üëÅÔ∏è Ver Detalhes
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-icon">üìä</div>
                <h3>Nenhuma ata encontrada</h3>
                <p>N√£o h√° atas registradas para {{ mes_selecionado_nome }}</p>
                <a href="{{ url_for('nova_ata') }}" class="btn">Criar Primeira Ata</a>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function carregarAtas(mes) {
    if (!mes) {
        document.getElementById('atas-container').innerHTML = '';
        return;
    }
    
    // Mostrar loading moderno
    document.getElementById('atas-container').innerHTML = `
        <div class="loading-state">
            <div class="loading-spinner"></div>
            <span>Carregando atas...</span>
        </div>
    `;
    
    // Fazer requisi√ß√£o AJAX
    fetch(`/atas/mes/${mes}`)
        .then(response => response.text())
        .then(html => {
            document.getElementById('atas-container').innerHTML = html;
        })
        .catch(error => {
            console.error('Erro:', error);
            document.getElementById('atas-container').innerHTML = `
                <div class="error-state">
                    <div class="error-icon">‚ö†Ô∏è</div>
                    <h3>Erro ao carregar atas</h3>
                    <p>Tente novamente em alguns instantes</p>
                </div>
            `;
        });
}

// Carregar atas do m√™s atual ao abrir a p√°gina
document.addEventListener('DOMContentLoaded', function() {
    const mesAtual = "{{ mes_atual }}";
    if (mesAtual) {
        setTimeout(() => carregarAtas(mesAtual), 300);
    }
});
</script>

<style>
.header-section {
    text-align: center;
    margin-bottom: 2rem;
}

.subtitle {
    color: var(--church-gray-600);
    font-size: 1.1rem;
    margin-top: 0.5rem;
}

.filter-section {
    background: var(--church-gray-100);
    padding: 2rem;
    border-radius: var(--radius);
    margin: 2rem 0;
}

.filter-header {
    margin-bottom: 1.5rem;
}

.select-wrapper {
    position: relative;
}

.select-wrapper select {
    appearance: none;
    padding-right: 3rem;
}

.select-arrow {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    pointer-events: none;
    color: var(--church-gray-600);
}

.section-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 2rem;
    gap: 1rem;
}

.result-count {
    background: var(--church-blue);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 600;
}

.results-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
}

.ata-card {
    background: var(--church-white);
    border: 1px solid var(--church-gray-200);
    border-radius: var(--radius-sm);
    padding: 1.5rem;
    transition: all 0.3s ease;
}

.ata-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    border-color: var(--church-blue);
}

.ata-header {
    display: flex;
    justify-content: between;
    align-items: start;
    margin-bottom: 1rem;
}

.ata-type {
    background: var(--church-blue);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
}

.ata-type.sacramental {
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
}

.ata-type.batismo {
    background: linear-gradient(135deg, #10b981, #047857);
}

.ata-date {
    color: var(--church-gray-600);
    font-size: 0.9rem;
}

.ata-body {
    margin-bottom: 1.5rem;
}

.status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
}

.status-badge.completa {
    background: #dcfce7;
    color: #166534;
}

.status-badge.pendente {
    background: #fef3c7;
    color: #92400e;
}

.ata-actions {
    display: flex;
    gap: 0.5rem;
}

.btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
}

.empty-state, .error-state {
    text-align: center;
    padding: 3rem 2rem;
    color: var(--church-gray-600);
}

.empty-icon, .error-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
}

.loading-state {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    padding: 3rem;
    color: var(--church-gray-600);
}

.reuniao-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.badge {
    background: var(--church-gold);
    color: var(--church-gray-800);
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
}

.reuniao-details {
    display: grid;
    gap: 0.75rem;
}

.detail-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.detail-label {
    font-weight: 600;
    color: var(--church-dark-blue);
}

.detail-value {
    color: var(--church-gray-600);
}

.status-complete {
    color: #166534;
    font-weight: 600;
}

.status-pending {
    color: #dc2626;
    font-weight: 600;
}

@media (max-width: 768px) {
    .section-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .results-grid {
        grid-template-columns: 1fr;
    }
    
    .reuniao-info {
        flex-direction: column;
        gap: 1.5rem;
    }
}
</style>
{% endblock %}